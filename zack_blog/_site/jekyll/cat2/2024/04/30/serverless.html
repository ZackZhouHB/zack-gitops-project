<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ZackBlog AWS Serverless webhosting | Zack’s Blog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="ZackBlog AWS Serverless webhosting" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How about this zackblog go serverless ?" />
<meta property="og:description" content="How about this zackblog go serverless ?" />
<link rel="canonical" href="http://localhost:4000/jekyll/cat2/2024/04/30/serverless.html" />
<meta property="og:url" content="http://localhost:4000/jekyll/cat2/2024/04/30/serverless.html" />
<meta property="og:site_name" content="Zack’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-04-30T10:15:29+10:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ZackBlog AWS Serverless webhosting" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-04-30T10:15:29+10:00","datePublished":"2024-04-30T10:15:29+10:00","description":"How about this zackblog go serverless ?","headline":"ZackBlog AWS Serverless webhosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/jekyll/cat2/2024/04/30/serverless.html"},"url":"http://localhost:4000/jekyll/cat2/2024/04/30/serverless.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Zack&apos;s Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Zack&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/certificate/">Education &amp; Certificate</a><a class="page-link" href="/pro/">Work Experiences</a><a class="page-link" href="/skillroadmap/">Skill Roadmap</a><a class="page-link" href="/aboutme/">About Me</a><a class="page-link" href="/gitrepo/">Github Repos</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">ZackBlog AWS Serverless webhosting</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-04-30T10:15:29+10:00" itemprop="datePublished">Apr 30, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><b> How about this zackblog go serverless ?</b></p>

<p>In this article, I will see how to host “zackweb” as a static web application using bellow AWS serverless options:</p>

<ul>
  <li>
    <p>S3 static webhosting</p>
  </li>
  <li>
    <p>AWS CDK + CloudFront</p>
  </li>
</ul>

<p><b> Prerequisite </b></p>

<ul>
  <li>Add one more step in existing Github Action workflow to copy the static web content to newly created S3 bucket</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># edit github action workflow</span>
aws s3 <span class="nb">cp</span> ~/zack-gitops-project/zack_blog/_site/<span class="k">*</span> s3://zackweb-serverless/ <span class="nt">--recursive</span>

<span class="c"># validate content in s3 bucket</span>
ubuntu@ip-172-31-26-78:~<span class="nv">$ </span>aws s3 <span class="nb">ls </span>s3://zackweb-serverless <span class="nt">--summarize</span>
                           PRE aboutme/
                           PRE assets/
                           PRE certificate/
                           PRE gitrepo/
                           PRE jekyll/
                           PRE pro/
                           PRE skillroadmap/
2024-04-30 14:55:05       4455 404.html
2024-04-30 14:55:05        504 Dockerfile
2024-04-30 14:55:06      80555 feed.xml
2024-04-30 14:55:06       7760 index.html
2024-04-30 14:55:06          0 nginx.conf

Total Objects: 5
   Total Size: 93274</code></pre></figure>

<p><b> Option 1: S3 static webhosting </b></p>

<p>Go AWS console, under S3 bucket “zackweb-serverless” properties, enable static website hosting, update the bucket website endpoint address to Godaddy DNS record.</p>

<p><img src="/assets/serverless2.png" alt="image tooltip here" /></p>

<p><b> Option 2: using AWS CDK + CDN </b></p>

<p>With AWS CDK and CDN, the “zackweb” can be straightforward distributed from an S3 bucket accessible to the public by using CloudFront.</p>

<p><img src="/assets/serverless3.png" alt="image tooltip here" /></p>

<p>the steps will be:</p>

<ol>
  <li>
    <p>Enable AWS CDK on EC2 bastion host.</p>
  </li>
  <li>
    <p>S3 bucker ready and copy static web content into it (done above with modification of existing github action workflow)</p>
  </li>
  <li>
    <p>Establish a CloudFront distribution to host a static To-Do web application.</p>
  </li>
  <li>
    <p>Deploy the AWS CDK solution to host the To-do application.</p>
  </li>
</ol>

<ul>
  <li>install AWS CDK on bastion EC2 host</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># AWS CDK requires nodejs newer version</span>
ubuntu@ip-172-31-26-78:~<span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>nodejs <span class="nt">-y</span>
ubuntu@ip-172-31-26-78:~<span class="nv">$ </span><span class="nb">sudo </span>npm cache clean <span class="nt">-f</span>
ubuntu@ip-172-31-26-78:~<span class="nv">$ </span><span class="nb">sudo </span>npm <span class="nb">install</span> <span class="nt">-g</span> n
ubuntu@ip-172-31-26-78:~<span class="nv">$ </span><span class="nb">sudo </span>n stable
ubuntu@ip-172-31-26-78:~<span class="nv">$ </span>nodejs <span class="nt">--version</span>
v12.22.9

<span class="c"># install aws-cdk cli</span>
ubuntu@ip-172-31-26-78:~<span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-g</span> aws-cdk
ubuntu@ip-172-31-26-78:~<span class="nv">$ </span>cdk <span class="nt">--version</span>
2.139.1 <span class="o">(</span>build b88f959<span class="o">)</span>

<span class="c"># check aws credential and bootstrap CDK</span>
ubuntu@ip-172-31-26-78:~<span class="nv">$ </span>aws sts get-caller-identity
<span class="o">{</span>
    <span class="s2">"UserId"</span>: <span class="s2">"AIDxxxxxxxxx7ZV"</span>,
    <span class="s2">"Account"</span>: <span class="s2">"8xxxxxx342"</span>,
    <span class="s2">"Arn"</span>: <span class="s2">"arn:aws:iam::8xxxxx342:user/zackcdk"</span>
<span class="o">}</span>

<span class="c"># bootstrap CDK</span>
ubuntu@ip-172-31-26-78:~<span class="nv">$ </span><span class="nb">sudo </span>cdk bootstrap aws://8xxxxxxx2/ap-southeast-2

<span class="c"># init app</span>
ubuntu@ip-172-31-26-78:~<span class="nv">$ </span> mkdir cdk
ubuntu@ip-172-31-26-78:~<span class="nv">$ </span><span class="nb">cd </span>cdk
ubuntu@ip-172-31-26-78:~/cdk# cdk init app <span class="nt">--language</span><span class="o">=</span>typescript
Initializing a new git repository...
Executing npm install...
✅ All <span class="k">done</span><span class="o">!</span>

<span class="c"># create CDK code</span>

ubuntu@ip-172-31-26-78:~/cdk/lib# vim cdk-stack.ts

import <span class="k">*</span> as cdk from <span class="s1">'@aws-cdk/core'</span><span class="p">;</span>
import <span class="k">*</span> as cloudfront from <span class="s1">'@aws-cdk/aws-cloudfront'</span><span class="p">;</span>
import <span class="k">*</span> as origins from <span class="s1">'@aws-cdk/aws-cloudfront-origins'</span><span class="p">;</span>

<span class="nb">export </span>class ZackWebStack extends cdk.Stack <span class="o">{</span>
  constructor<span class="o">(</span>scope: cdk.Construct, <span class="nb">id</span>: string, props?: cdk.StackProps<span class="o">)</span> <span class="o">{</span>
    super<span class="o">(</span>scope, <span class="nb">id</span>, props<span class="o">)</span><span class="p">;</span>

    // existing S3 bucket
    const existingBucketName <span class="o">=</span> <span class="s1">'zackweb-serverless'</span><span class="p">;</span>

    // Create a CloudFront distribution
    const distribution <span class="o">=</span> new cloudfront.Distribution<span class="o">(</span>this, <span class="s1">'MyDistribution'</span>, <span class="o">{</span>
      defaultBehavior: <span class="o">{</span>
        origin: new origins.S3OriginFromBucketName<span class="o">(</span>existingBucketName<span class="o">)</span>
      <span class="o">}</span>,
      defaultRootObject: <span class="s1">'index.html'</span> // default root object
    <span class="o">})</span><span class="p">;</span>

    // Output the CloudFront distribution domain name
    new cdk.CfnOutput<span class="o">(</span>this, <span class="s1">'CloudFrontDomainName'</span>, <span class="o">{</span>
      value: distribution.distributionDomainName
    <span class="o">})</span><span class="p">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c"># install required module</span>

ubuntu@ip-172-31-26-78:~/cdk/lib# npm <span class="nb">install</span> @aws-cdk/core
ubuntu@ip-172-31-26-78:~/cdk/lib# npm <span class="nb">install</span> @aws-cdk/aws-cloudfront
ubuntu@ip-172-31-26-78:~/cdk/lib# npm <span class="nb">install</span> @aws-cdk/aws-cloudfront-origins

<span class="c"># Deploy stack</span>
ubuntu@ip-172-31-26-78:~/cdk/lib# <span class="nb">cd</span> ..
ubuntu@ip-172-31-26-78:~/cdk/# cdk deploy</code></pre></figure>

<ul>
  <li>The “zackweb” is now hosted on the AWS with serverless deployment !</li>
</ul>

<p><img src="/assets/serverless4.png" alt="image tooltip here" /></p>

<p><b> Conclusion</b></p>

<p>Now we move the blog onto AWS with serverless website hosting, using both S3 static webhosting and AWS CDK plus Cloudfront.</p>

  </div><a class="u-url" href="/jekyll/cat2/2024/04/30/serverless.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Zack&#39;s Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Zack&#39;s Blog</li><li><a class="u-email" href="mailto:zhbsoftboy1@gmail.com">zhbsoftboy1@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ZackZhouHB"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ZackZhouHB</span></a></li><li><a href="https://www.twitter.com/ZackZ"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">ZackZ</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>## AWS   ## Jenkins  ## Microservices ## Automation ## K8S   ## CICD     ## Gitops </p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
