<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Python Microservice: Containerization | Zack’s Blog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Python Microservice: Containerization" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="About Python Flask" />
<meta property="og:description" content="About Python Flask" />
<link rel="canonical" href="http://localhost:4000/jekyll/cat2/2024/05/18/py-flask1.html" />
<meta property="og:url" content="http://localhost:4000/jekyll/cat2/2024/05/18/py-flask1.html" />
<meta property="og:site_name" content="Zack’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-05-18T10:15:29+10:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Python Microservice: Containerization" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-05-18T10:15:29+10:00","datePublished":"2024-05-18T10:15:29+10:00","description":"About Python Flask","headline":"Python Microservice: Containerization","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/jekyll/cat2/2024/05/18/py-flask1.html"},"url":"http://localhost:4000/jekyll/cat2/2024/05/18/py-flask1.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Zack&apos;s Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Zack&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/certificate/">Education &amp; Certificate</a><a class="page-link" href="/pro/">Work Experiences</a><a class="page-link" href="/skillroadmap/">Skill Roadmap</a><a class="page-link" href="/aboutme/">About Me</a><a class="page-link" href="/gitrepo/">Github Repos</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Python Microservice: Containerization</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-05-18T10:15:29+10:00" itemprop="datePublished">May 18, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><b> About Python Flask</b></p>

<p>Flask stands out as one of Python’s most popular web frameworks. Designed for versatility and ease of use, Flask offers a robust starting point for crafting web apps.</p>

<p>By the following posts, I will use Flask to</p>

<ul>
  <li>
    <p>create a series of Python web applications from simple app (Hello Zack)</p>
  </li>
  <li>
    <p>develop microservices applications (order and user), deploy using Docker compose</p>
  </li>
  <li>
    <p>Create Python API gateway application to</p>
  </li>
  <li>
    <p>Integrate with Consul for service discovery and register</p>
  </li>
  <li>
    <p>Enable logging with ELK, monitoring with Prometheus &amp; Grafana</p>
  </li>
  <li>
    <p>Last I will create Kubernetes manifast for K8S deployment.</p>
  </li>
  <li>
    <p>I will skip ArgoCD and Github Action as I had done similar posts before.  </p>
  </li>
</ul>

<p><b> Get started with Flask env and simple app</b></p>

<p>I will skip the installation for Docker and python3 as those can be found via the official Docker and Python website.</p>

<p>In the application Python code, I will import the <code class="language-plaintext highlighter-rouge">Flask</code> class from the <code class="language-plaintext highlighter-rouge">flask</code> module. Flask is a micro web framework written in Python. The Flask class is used to create a Flask application instance, which will be used to handle incoming web requests and route them to the appropriate functions in our code.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># local create a new virtualenv </span>
virtualenv flask
<span class="c"># pip3 install virtualenv </span>
<span class="nb">cd </span>flask
<span class="c"># activate the virtualenv</span>
<span class="nb">source </span>bin/activate

<span class="c"># install flask</span>
pip <span class="nb">install </span>flask

<span class="c"># create a simple Flask app</span>
vim app.py

from flask import Flask

<span class="c"># create an instance of the Flask class and store it in the app variable, The __name__ variable is passed as an argument to the Flask constructor. This helps Flask determine the root path for the application, which is useful for locating resources, templates, and static files</span>
app <span class="o">=</span> Flask<span class="o">(</span>__name__<span class="o">)</span>


<span class="c"># This is a decorator that Flask provides. A decorator is a way to modify the behavior of a function or method. In this case, @app.route('/') tells Flask to execute the following function (in this case, hello_zack) when the root URL ('/') of the web application is accessed</span>
@app.route<span class="o">(</span><span class="s1">'/'</span><span class="o">)</span>

<span class="c"># This line defines a function named hello_zack. This function will be called when a request to the root URL ('/') is made.</span>
def hello_zack<span class="o">()</span>:

<span class="c"># This line returns the string 'Hello, Zack!' as the response to the web request. When someone accesses the root URL, they will see this message in their web browser.</span>
 <span class="k">return</span> <span class="s1">'Hello, Zack!'</span>


<span class="c"># This is a common Python idiom that checks whether the script is being run directly or being imported as a module in another script</span>
<span class="k">if </span>__name__ <span class="o">==</span> <span class="s1">'__main__'</span>:

<span class="c"># This line starts the Flask development server. The host='0.0.0.0' argument makes the server accessible from any network interface, with the default port for Flask is 5000</span>
 app.run<span class="o">(</span><span class="nv">host</span><span class="o">=</span><span class="s1">'0.0.0.0'</span>, <span class="nv">port</span><span class="o">=</span>5000<span class="o">)</span>

<span class="c"># run it</span>
<span class="o">(</span>flask<span class="o">)</span> root@ubt-server:~/zack-gitops-project/Python-flask/01-single-app# python3 app.py 

 <span class="k">*</span> Serving Flask app <span class="s1">'app'</span>
 <span class="k">*</span> Debug mode: off
WARNING: This is a development server. Do not use it <span class="k">in </span>a production deployment. Use a production WSGI server instead.
 <span class="k">*</span> Running on all addresses <span class="o">(</span>0.0.0.0<span class="o">)</span>
 <span class="k">*</span> Running on http://127.0.0.1:5000
 <span class="k">*</span> Running on http://11.0.1.199:5000
Press CTRL+C to quit
11.0.1.1 - - <span class="o">[</span>18/Jul/2024 13:50:41] <span class="s2">"GET / HTTP/1.1"</span> 200 -</code></pre></figure>

<p><img src="/assets/flask1.png" alt="image tooltip here" /></p>

<p><b> Create “user” and “order” flask microservice apps</b></p>

<p>Now I will move to create 2 microservice applications with Flask.</p>

<p>In design I will import the <code class="language-plaintext highlighter-rouge">Flask</code> class and <code class="language-plaintext highlighter-rouge">jsonify</code> function to create a Flask application instance, define a route (/orders) and a corresponding function (get_orders) to handle requests to that route, then return a JSON response with order details. Same design for user.py as well.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># order_service.py</span>
from flask import Flask, jsonify

app <span class="o">=</span> Flask<span class="o">(</span>__name__<span class="o">)</span>

@app.route<span class="o">(</span><span class="s1">'/orders'</span><span class="o">)</span>
def get_orders<span class="o">()</span>:
 orders <span class="o">=</span> <span class="o">[</span>
 <span class="o">{</span><span class="s1">'id'</span>: 1, <span class="s1">'item'</span>: <span class="s1">'Laptop'</span>, <span class="s1">'price'</span>: 1200<span class="o">}</span>,
 <span class="o">{</span><span class="s1">'id'</span>: 2, <span class="s1">'item'</span>: <span class="s1">'Phone'</span>, <span class="s1">'price'</span>: 800<span class="o">}</span>
 <span class="o">]</span>
 <span class="k">return </span>jsonify<span class="o">(</span>orders<span class="o">)</span>

<span class="k">if </span>__name__ <span class="o">==</span> <span class="s1">'__main__'</span>:
 app.run<span class="o">(</span><span class="nv">host</span><span class="o">=</span><span class="s1">'0.0.0.0'</span>, <span class="nv">port</span><span class="o">=</span>5002<span class="o">)</span>


<span class="c"># user_service.py</span>
from flask import Flask, jsonify

app <span class="o">=</span> Flask<span class="o">(</span>__name__<span class="o">)</span>

@app.route<span class="o">(</span><span class="s1">'/users'</span><span class="o">)</span>
def get_users<span class="o">()</span>:
 <span class="nb">users</span> <span class="o">=</span> <span class="o">[</span>
 <span class="o">{</span><span class="s1">'id'</span>: 1, <span class="s1">'name'</span>: <span class="s1">'Alice'</span><span class="o">}</span>,
 <span class="o">{</span><span class="s1">'id'</span>: 2, <span class="s1">'name'</span>: <span class="s1">'Bob'</span><span class="o">}</span>
 <span class="o">]</span>
 <span class="k">return </span>jsonify<span class="o">(</span><span class="nb">users</span><span class="o">)</span>

<span class="k">if </span>__name__ <span class="o">==</span> <span class="s1">'__main__'</span>:
 app.run<span class="o">(</span><span class="nv">host</span><span class="o">=</span><span class="s1">'0.0.0.0'</span>, <span class="nv">port</span><span class="o">=</span>5001<span class="o">)</span></code></pre></figure>

<p>Create Dockerfile for containirztion</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># Dockerfile-order</span>

<span class="c"># Use an official Python runtime as a parent image</span>
FROM python:3.9-slim

<span class="c"># Set the working directory in the container</span>
WORKDIR /app

<span class="c"># Copy the current directory contents into the container at /app</span>
COPY order_service.py /app

<span class="c"># Install any needed packages specified in requirements.txt</span>
RUN pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> flask

<span class="c"># Make port 5002 available to the world outside this container</span>
EXPOSE 5002

<span class="c"># Define environment variable</span>
ENV <span class="nv">FLASK_APP</span><span class="o">=</span>order_service.py

<span class="c"># Run order_service.py when the container launches</span>
CMD <span class="o">[</span><span class="s2">"flask"</span>, <span class="s2">"run"</span>, <span class="s2">"--host=0.0.0.0"</span>, <span class="s2">"--port=5002"</span><span class="o">]</span>


<span class="c"># Dockerfile-order</span>

<span class="c"># Use an official Python runtime as a parent image</span>
FROM python:3.9-slim

<span class="c"># Set the working directory in the container</span>
WORKDIR /app

<span class="c"># Copy the current directory contents into the container at /app</span>
COPY user_service.py /app

<span class="c"># Install any needed packages specified in requirements.txt</span>
RUN pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> flask

<span class="c"># Make port 5001 available to the world outside this container</span>
EXPOSE 5001

<span class="c"># Define environment variable</span>
ENV <span class="nv">FLASK_APP</span><span class="o">=</span>user_service.py

<span class="c"># Run order_service.py when the container launches</span>
CMD <span class="o">[</span><span class="s2">"flask"</span>, <span class="s2">"run"</span>, <span class="s2">"--host=0.0.0.0"</span>, <span class="s2">"--port=5001"</span><span class="o">]</span></code></pre></figure>

<p>Build, tag and run it using docker-compose</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># docker-compose.yml</span>
version: <span class="s1">'3'</span>
services:
 user-service:
 build:
 context: <span class="nb">.</span>
 dockerfile: Dockerfile_user
 ports:
 - <span class="s2">"5001:5001"</span>
 order-service:
 build:
 context: <span class="nb">.</span>
 dockerfile: Dockerfile_order
 ports:
 - <span class="s2">"5002:5002"</span>

docker-compose up <span class="nt">--build</span>

Creating 02-microservice-docker-compose_user-service_1  ... <span class="k">done
</span>Creating 02-microservice-docker-compose_order-service_1 ... <span class="k">done
</span>Attaching to 02-microservice-docker-compose_order-service_1, 02-microservice-docker-compose_user-service_1
order-service_1  |  <span class="k">*</span> Serving Flask app <span class="s1">'order_service.py'</span>
order-service_1  |  <span class="k">*</span> Debug mode: off
order-service_1  | WARNING: This is a development server. Do not use it <span class="k">in </span>a production deployment. Use a production WSGI server instead.
order-service_1  |  <span class="k">*</span> Running on all addresses <span class="o">(</span>0.0.0.0<span class="o">)</span>
order-service_1  |  <span class="k">*</span> Running on http://127.0.0.1:5002
order-service_1  |  <span class="k">*</span> Running on http://192.168.16.3:5002
order-service_1  | Press CTRL+C to quit
user-service_1   |  <span class="k">*</span> Serving Flask app <span class="s1">'user_service.py'</span>
user-service_1   |  <span class="k">*</span> Debug mode: off
user-service_1   | WARNING: This is a development server. Do not use it <span class="k">in </span>a production deployment. Use a production WSGI server instead.
user-service_1   |  <span class="k">*</span> Running on all addresses <span class="o">(</span>0.0.0.0<span class="o">)</span>
user-service_1   |  <span class="k">*</span> Running on http://127.0.0.1:5001
user-service_1   |  <span class="k">*</span> Running on http://192.168.16.2:5001
user-service_1   | Press CTRL+C to quit</code></pre></figure>

<p><img src="/assets/flask2.png" alt="image tooltip here" />
<img src="/assets/flask3.png" alt="image tooltip here" /></p>

<p><b> Conclusion</b></p>

<p>Now we can use Python flask to create a simple web application and containerized it using Dockerfile</p>

<p>In the next post, I will see how to use API Gateway and Consul for more features to this Python applications.</p>

  </div><a class="u-url" href="/jekyll/cat2/2024/05/18/py-flask1.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Zack&#39;s Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Zack&#39;s Blog</li><li><a class="u-email" href="mailto:zhbsoftboy1@gmail.com">zhbsoftboy1@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ZackZhouHB"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ZackZhouHB</span></a></li><li><a href="https://www.twitter.com/ZackZ"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">ZackZ</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>## AWS   ## Jenkins  ## Microservices ## Automation ## K8S   ## CICD     ## Gitops </p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
