<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>RedHat Certified RHCSA &amp; RHCE | Zack’s Blog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="RedHat Certified RHCSA &amp; RHCE" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The RedHat Certs" />
<meta property="og:description" content="The RedHat Certs" />
<link rel="canonical" href="http://localhost:4000/jekyll/cat2/2024/07/03/redhat-cert.html" />
<meta property="og:url" content="http://localhost:4000/jekyll/cat2/2024/07/03/redhat-cert.html" />
<meta property="og:site_name" content="Zack’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-03T10:15:29+10:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="RedHat Certified RHCSA &amp; RHCE" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-07-03T10:15:29+10:00","datePublished":"2024-07-03T10:15:29+10:00","description":"The RedHat Certs","headline":"RedHat Certified RHCSA &amp; RHCE","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/jekyll/cat2/2024/07/03/redhat-cert.html"},"url":"http://localhost:4000/jekyll/cat2/2024/07/03/redhat-cert.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Zack&apos;s Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Zack&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/certificate/">Education &amp; Certificate</a><a class="page-link" href="/pro/">Work Experiences</a><a class="page-link" href="/skillroadmap/">Skill Roadmap</a><a class="page-link" href="/aboutme/">About Me</a><a class="page-link" href="/gitrepo/">Github Repos</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">RedHat Certified RHCSA &amp; RHCE</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-07-03T10:15:29+10:00" itemprop="datePublished">Jul 3, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><b>The RedHat Certs</b></p>

<p>Recently I have been working on Redhat certifications to add to all my <a href="https://www.credly.com/users/zhou-zack/badges"><b>professional certs on Credly</b></a>.</p>

<p>Here are the RedHat exam results and preparations.</p>

<p><img src="/assets/rhcert1.png" alt="image tooltip here" /></p>

<ul>
  <li>Red Hat Certified System Administrator (RHCSA)</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># RHCSA</span>
<span class="c"># Red Hat Enterprise Linux 9</span>

1. network
 
hostnamectl nmcli <span class="nt">-h</span>
 
 
hostnamectl set-hostname node1.domain250.example.com
 
nmcli connection modify <span class="s2">"Wired connection 1"</span> ipv4.method manual ipv4.dns 172.25.250.254 ipv4.addresses 172.25.250.100/24 ipv4.gateway 172.25.250.254 autoconnect <span class="nb">yes
 
 
</span>nmcli connection up <span class="s2">"Wired connection 1"</span>
 
 
2. yum repo
 
yum repolist
yum repoinfo
 
vim /etc/yum/yum.repos.d/rhcsa.repo
 
<span class="o">[</span>base]
<span class="nv">name</span><span class="o">=</span>base
<span class="nv">baseurl</span><span class="o">=</span>http://content/rhel9.0/x86_64/dvd/BaseOS
<span class="nv">gpgcheck</span><span class="o">=</span>0
<span class="nv">enabled</span><span class="o">=</span>1
 
<span class="o">[</span>app]
<span class="nv">name</span><span class="o">=</span>app
<span class="nv">baseurl</span><span class="o">=</span>http://content/rhel9.0/x86_64/dvd/appstream
<span class="nv">gpgcheck</span><span class="o">=</span>0
<span class="nv">enabled</span><span class="o">=</span>1
 
validate:
 
3. SElinux

semanage <span class="nt">-h</span>
man semanage port
man semanage fcontext   <span class="c"># !!!</span>

<span class="nb">ls</span> <span class="nt">-Z</span> /var/www/html  <span class="c"># check se content</span>

systemctl status httpd

semanage port <span class="nt">-a</span> <span class="nt">-t</span> http_port_t <span class="nt">-p</span> tcp 82

firewall-cmd  <span class="nt">--add-port</span><span class="o">=</span>82/tcp <span class="nt">--permanent</span>
firewall-cmd  <span class="nt">--add-service</span><span class="o">=</span>http <span class="nt">--permanent</span>
firewall-cmd <span class="nt">--reload</span>

semanage fcontext <span class="nt">-m</span> <span class="nt">-t</span> httpd_sys_content_t /var/www/html/file1  <span class="c"># !!!</span>

restorecon <span class="nt">-Rv</span> /var/www/html/  <span class="c"># -R v must !!</span>

systemctl restart httpd
systemctl <span class="nb">enable </span>httpd
systemctl status httpd

4. add user and group
 
groupadd sysmgrs
useradd harry <span class="nt">-G</span> sysmgrs
useradd natasha <span class="nt">-G</span> sysmgrs
useradd sarah <span class="nt">-s</span> /sbin/nologin
 
passwd harry
 
5. cron

crontab <span class="nt">-e</span> <span class="nt">-u</span> harry
 
23 14 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="s2">"/usr/bin/echo hello"</span>


<span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> command_to_be_executed
- - - - -
| | | | |
| | | | +----- Day of the week <span class="o">(</span>0 - 7<span class="o">)</span> <span class="o">(</span><span class="nv">Sunday</span><span class="o">=</span>0 or 7<span class="o">)</span>
| | | +------- Month <span class="o">(</span>1 - 12<span class="o">)</span> <span class="o">(</span><span class="nv">January</span><span class="o">=</span>1, <span class="nv">December</span><span class="o">=</span>12<span class="o">)</span>
| | +--------- Day of the month <span class="o">(</span>1 - 31<span class="o">)</span>
| +----------- Hour <span class="o">(</span>0 - 23<span class="o">)</span>
+------------- Minute <span class="o">(</span>0 - 59<span class="o">)</span>
 
6. collborative directory
 
 
<span class="nb">mkdir</span> /home/managers
<span class="nb">chgrp </span>sysmgrs /home/managers
<span class="nb">chmod </span>2770 /home/managers
 
2770: group <span class="o">=</span> rwx, owner <span class="o">=</span> rwx, user <span class="o">=</span> none specialpermission <span class="o">=</span> group

Three special permission bits: setuid <span class="o">(</span>4<span class="o">)</span>, setgid <span class="o">(</span>2<span class="o">)</span>, and sticky <span class="o">(</span>1<span class="o">)</span><span class="nb">.</span>

setuid <span class="o">(</span>4<span class="o">)</span>: When <span class="nb">set </span>on an executable file, this bit allows the file to be executed with the permissions of the file owner.

<span class="nb">chmod </span>4755 /path/to/executable
The permissions of the executable file become rwsr-xr-x.
The s <span class="k">in </span>the owner’s execute position <span class="o">(</span>rws<span class="o">)</span> indicates the setuid bit is set.

setgid <span class="o">(</span>2<span class="o">)</span>: When <span class="nb">set </span>on a directory, files created <span class="k">in </span>the directory inherit the group ID of the directory, rather than the group ID of the user <span class="nb">who </span>created the file.
<span class="nb">chmod </span>2770 /home/managers
The permissions of the directory become rwxrws---.
The s <span class="k">in </span>the group’s execute position <span class="o">(</span>rws<span class="o">)</span> indicates the setgid bit is set.
Any file created <span class="k">in</span> /home/managers will have its group <span class="nb">set </span>to the group of the directory <span class="o">(</span>managers<span class="o">)</span><span class="nb">.</span>
rwx <span class="o">(</span>7<span class="o">)</span> <span class="k">for </span>the owner means the owner has <span class="nb">read</span>, write, and execute permissions.
rws <span class="o">(</span>7<span class="o">)</span> <span class="k">for </span>the group means the group has <span class="nb">read</span>, write, and execute permissions, and the setgid bit is <span class="nb">set</span> <span class="o">(</span>indicated by s<span class="o">)</span><span class="nb">.</span>
<span class="nt">---</span> <span class="o">(</span>0<span class="o">)</span> <span class="k">for </span>others means no permissions <span class="k">for </span>others.

sticky <span class="o">(</span>1<span class="o">)</span>: When <span class="nb">set </span>on a directory, <span class="nb">users </span>can only delete or rename files within that directory <span class="k">if </span>they are the owner of the file or the directory.
<span class="nb">chmod </span>1777 /tmp
The permissions of the directory become rwxrwxrwt.
The t <span class="k">in </span>the others’ execute position <span class="o">(</span>rwt<span class="o">)</span> indicates the sticky bit is set.
This is often used <span class="k">in </span>directories like /tmp to prevent <span class="nb">users </span>from deleting each other’s files.

setuid + setgid <span class="o">(</span>4 + 2 <span class="o">=</span> 6<span class="o">)</span>:
<span class="nb">chmod </span>6755 /path/to/executable
The permissions become rwsr-sr-x.

setgid + sticky <span class="o">(</span>2 + 1 <span class="o">=</span> 3<span class="o">)</span>:
<span class="nb">chmod </span>3770 /home/shared
The permissions become rwxrws--t.

7. NTP

yum search ntp

vim /etc/chrony.conf

server materials.example.com iburst

systemctl restart chronyd

8. autofs

<span class="nb">id </span>remoteuser1

yum <span class="nb">install </span>autofs <span class="nt">-y</span>
yum <span class="nb">install </span>nfs-utils

showmount <span class="nt">-e</span> materials.example.com

vim /etc/auto.master

/rhome /etc/autofs.misc

vim /etc/autofs.misc

remoteuser1     <span class="nt">-rw</span>     materials.example.com:/rhome/remoteuser1
remoteuser1 	<span class="nt">-fstype</span><span class="o">=</span>nfs,rw 	materials.example.com:/rhome/remoteuser1

systemctl restart autofs

validate 

from other machine
ssh remoteuser1@node1
<span class="nb">cd</span> /rhome
<span class="nb">cd </span>remoteuser1
<span class="nb">df</span> <span class="nt">-h</span>

mount | <span class="nb">grep </span>rhome

9. user with uid

useradd <span class="nt">-u</span> 3533 manalo
passwd manalo

10. find file by user

find <span class="nt">-h</span>
man find

<span class="nb">mkdir</span> /root/findfiles

find <span class="nt">-user</span> jacques <span class="nt">-exec</span> <span class="nb">cp</span> <span class="nt">-a</span> <span class="o">{}</span> /root/findfiles <span class="se">\;</span>  <span class="c"># need to be remembered</span>

11. <span class="nb">grep </span>line from file

<span class="nb">cat</span> /usr/share/xml/iso-codes/iso_639_3.xml | <span class="nb">grep </span>ng <span class="o">&gt;</span> /root/list

12. <span class="nb">tar </span>bzip2 and <span class="nb">gzip

tar</span> <span class="nt">-cvjf</span> /root/backup.tar.bz2 /usr/local  <span class="c"># j need to be remembered</span>

<span class="nb">tar</span> <span class="nt">-cvzf</span> /root/backup.tar.gz /usr/local  <span class="c"># z for gz </span>

<span class="nb">tar</span> <span class="nt">-xjf</span> backup.tar.bz2  <span class="c"># untar bz2</span>

<span class="nb">tar</span> <span class="nt">-xzf</span> backup.tar.gz   <span class="c"># untar gz </span>


validate 

file /root/backup.tar.bz2


13. podman build

use root to :

yum search container

yum <span class="nb">install </span>container-tools.noarch <span class="nt">-y</span>  <span class="c"># need to be done first !!</span>


ssh wallah@node1 <span class="c">## very important</span>

wget http://classroom/Containerfile

podman login <span class="nt">-u</span> admin <span class="nt">-p</span> redhat321 registry.lab.example.com

man podman build

podman build <span class="nt">-t</span> pdf <span class="nb">.</span>



14. container as a service 

as user wallah

<span class="nb">sudo mkdir</span> /opt/file
<span class="nb">sudo mkdir</span> /opt/progress

<span class="nb">sudo chown </span>wallah:wallah /opt/file
<span class="nb">sudo chown </span>wallah:wallah /opt/progress

podman run <span class="nt">-d</span> <span class="nt">--name</span> ascii2pdf <span class="nt">-v</span> /opt/file:/dir1 <span class="nt">-v</span> /opt/progress:/dir2 pdf  <span class="c"># --name and -d !!!</span>

podman ps

<span class="nb">mkdir</span> <span class="nt">-p</span> ~/.config/systemd/user <span class="c"># -p </span>

<span class="nb">cd</span> ~/.config/systemd/user

podman generate systemd <span class="nt">-n</span> ascii2pdf <span class="nt">-f</span> <span class="nt">--new</span>  <span class="c"># podman generate systemd --help</span>

podman stop ascii2pdf
podman container <span class="nb">rm </span>ascii2pdf



loginctl <span class="nt">--help</span>

loginctl enable-linger wallah
loginctl show-user wallah


systemctl <span class="nt">--user</span> daemon-reload
systemctl <span class="nt">--user</span> start container-ascii2pdf
systemctl <span class="nt">--user</span> <span class="nb">enable </span>container-ascii2pdf

validate:

<span class="nb">sudo </span>reboot

podman ps



15. <span class="nb">sudo </span>no password

visudo 

%sysmgrs       <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span>       NOPASSWD: ALL 

validate 

su - natasha

<span class="nb">sudo cat</span> /etc/shadow

16. <span class="nb">break </span>root 


add rw rd.break  <span class="c">#  need to be remembered</span>

<span class="nb">chroot</span> /sysroot
passwd root

<span class="nb">touch</span> /.autorelabel  <span class="c"># need to be remembered</span>
<span class="nb">sync

exit
</span>reboot

17. configure yum repo

18. logic volume size

lvextend <span class="nt">-L</span> 230M /dev/myvol/vo <span class="c"># need remember</span>

blkid /dev/mapper/myvol-vo: <span class="nv">UUID</span><span class="o">=</span><span class="s2">"d68a6907-91b6-4ca4-b736-e143936954b8"</span> <span class="nv">BLOCK_SIZE</span><span class="o">=</span><span class="s2">"1024"</span> <span class="nv">TYPE</span><span class="o">=</span><span class="s2">"ext4"</span>  <span class="c"># type</span>

resize2fs /dev/myvol/vo  <span class="c"># if ext4</span>

<span class="c"># xfs_growfs /dev/myvol/vo  # if xfs  !!!</span>

19. SWAP

lsblk  <span class="c"># check device</span>
    <span class="c"># decide which device to go</span>

fdisk /dev/sdc

n <span class="c"># create new</span>
last sector +512M
<span class="c"># write</span>

mkswap /dev/sdc1   <span class="c"># initialize </span>

vim /etc/fstab 
/dev/vdb3 swap swap defaults 0 0 <span class="c"># add new swap to boot </span>

swapon /dev/sdd1
swapon <span class="nt">-a</span>  <span class="c"># activate all swap</span>
swapon <span class="c"># list all activated swap</span>

20. VG LV

lsblk  <span class="c"># check device</span>
    <span class="c"># decide which device to go</span>

fdisk /dev/sdc
n <span class="c"># new</span>
p <span class="c"># primary</span>
2 <span class="c"># default partition</span>
last  <span class="nv">60x16mb</span><span class="o">=</span>960mb +1200M
w <span class="c"># write</span>

lsblk  <span class="c"># check device now should with new sdc2 with 1.2GB</span>

vgcreate <span class="nt">-h</span>
man vgcreate 
vgcreate <span class="nt">-s</span> 16M qagroup /dev/sdc2  <span class="c"># cerate pv with #  name : qagroup, # -s to define each physical extent size pv size 16M # use /dev/sdc2</span>

lvcreate <span class="nt">-h</span>
man lvcreate 
lvcreate <span class="nt">-l</span> 60 <span class="nt">-n</span> qa qagroup
lvscan

mkfs.  <span class="c"># check which type </span>
<span class="c"># yum provides */mkfs.vfat</span>

mkfs.vfat /dev/qagroup/qa

<span class="nb">mkdir</span> /mnt/qa

vim /etc/fstab
/dev/qagroup/qa /mnt/qa vfat defaults 0 0    <span class="c"># not vdd1, /dev/qagroup/qa , typy xfat</span>

mount <span class="nt">-a</span>   <span class="c"># remember</span>

df-Th


21. tuned

yum <span class="nt">-y</span> <span class="nb">install </span>tuned
systemctl <span class="nb">enable </span>tuned
systemctl restart tuned
tuned-adm active
tuned-adm recommend

tuned-adm profile virtual-guest
tuned-adm active</code></pre></figure>

<ul>
  <li>Red Hat Certified Engineer (RHCE)</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># RHCE</span>
<span class="c"># Ansible Automation Platform 2.2</span>
<span class="c"># Red Hat Enterprise Linux 9</span>
ssh greg@control

Q1: <span class="nb">install </span>ansible
<span class="nb">pwd</span> 

<span class="c"># install ansible core and navigator</span>

<span class="nb">sudo </span>yum <span class="nb">install </span>ansible-core <span class="nt">-y</span>
<span class="nb">sudo </span>yum <span class="nb">install </span>ansible-navigator.noarch <span class="nt">-y</span>

<span class="c"># define user greg's ansible folder</span>
<span class="c"># with inventory file</span>
<span class="c"># generate ansible.cfg from default cat /etc/ansible/ansible.cfg</span>
<span class="c"># create folders for mycollections and roles</span>

<span class="nb">mkdir </span>ansible
<span class="nb">cd </span>ansible
<span class="nb">touch </span>inventory

<span class="nb">mkdir</span> <span class="nt">-p</span> mycollections
<span class="nb">mkdir </span>roles

<span class="o">[</span>greg@control ansible]<span class="nv">$ </span>ll

<span class="nt">-rw-r--r--</span><span class="nb">.</span> 1 greg greg 54183 Jul  1 06:31 ansible.cfg
<span class="nt">-rw-r--r--</span><span class="nb">.</span> 1 greg greg    96 Jul  1 06:20 inventory
drwxr-xr-x. 2 greg greg     6 Jul  1 06:26 mycollection
drwxr-xr-x. 2 greg greg     6 Jul  1 06:26 roles

<span class="nb">cat</span> /etc/ansible/ansible.cfg

ansible-config init <span class="nt">--disabled</span> <span class="nt">-t</span> all <span class="o">&gt;</span> ansible.cfg

<span class="c"># define defaults for remote_user, inventory, host_key_checking, collection_path and roles_path</span>

vim ansible.cfg

<span class="o">[</span>defaults]

inventory <span class="o">=</span> /home/greg/ansible/inventory
remote_user <span class="o">=</span> greg
host_key_checking <span class="o">=</span> False
collections_path <span class="o">=</span> /home/greg/ansible/mycollection:~/.ansible/collections:/usr/share/ansible/collections
roles_path <span class="o">=</span> /home/greg/ansible/roles:~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles

<span class="o">[</span>privilege_escalation]
<span class="nv">become</span><span class="o">=</span>True

<span class="c"># define inventory, use : children to define a group in another group</span>

vim inventory

<span class="o">[</span>dev]
node1

<span class="o">[</span><span class="nb">test</span><span class="o">]</span>
node2

<span class="o">[</span>prod]
node3
node4

<span class="o">[</span>balancers]
node5

<span class="o">[</span>webservers:children]
prod

Validation:

ansible <span class="nt">--version</span>

ansible-inventory <span class="nt">--graph</span>
ansible all <span class="nt">-a</span> <span class="s2">"hostname"</span>

podman login <span class="nt">-u</span> admin <span class="nt">-p</span> redhat utility.lab.example.com

ansible-navigator images
ansible-navigator collections

<span class="c">###########################################################</span>
Q2: yum_repository

<span class="c"># search yum module </span>
ansible-doc <span class="nt">-l</span> | <span class="nb">grep </span>yum
ansible-doc yum_repository

vim yum_repo.yml

<span class="nt">---</span>
- name: Add multiple repositories into the same file <span class="o">(</span>1/2<span class="o">)</span>
  hosts: all
  tasks:
  - ansible.builtin.yum_repository:
      name: EX294_BASE
      description: EX294 base software
      baseurl: http://content/rhel9.0/x86_64/dvd/BaseOS
      gpgcheck: <span class="nb">yes
      </span>enabled: <span class="nb">yes
      </span>gpgkey: http://content/rhel9.0/x86_64/dvd/RPM-GPG-KEY-redhat-release
 
  - ansible.builtin.yum_repository:
      name: EX294_STREAM
      description: EX294 stream software
      gpgkey: http://content/rhel9.0/x86_64/dvd/RPM-GPG-KEY-redhat-release
      baseurl: http://content/rhel9.0/x86_64/dvd/AppStream
      enabled: <span class="nb">yes
      </span>gpgcheck: <span class="nb">yes

</span>ansible-playbook <span class="nt">--syntax-check</span> yum_repo.yml

ansible-navigator run yum_repo.yml <span class="nt">-m</span> stdout

ansible all <span class="nt">-a</span> <span class="s2">"yum repoinfo"</span>
ansible all <span class="nt">-a</span> <span class="s2">"yum install ftp -y"</span>

Q3: package

ansible-doc yum

vim packages.yml


<span class="nt">---</span>
- name: php
  hosts: dev,test,prod
  tasks:
  - ansible.builtin.yum:
      name: <span class="s2">""</span>
      state: present <span class="c"># add state</span>
    vars:     
      packages:
      - php   
      - mariadb

- name: devtools
  hosts: dev
  tasks:
  - ansible.builtin.yum:
      name: <span class="s2">"@RPM Development Tools"</span> <span class="c"># where the @ symbol indicates that "Development Tools" is a package group</span>
      state: present <span class="c"># add state</span>

- name: <span class="nb">install </span>dev update
  hosts: dev
  tasks:
  - ansible.builtin.yum:
      name: <span class="s1">'*'</span>
      state: latest

ansible-navigator run <span class="nt">-m</span> stdout packages.yml

ansible-playbook <span class="nt">--syntax-check</span> packages.yml


validate:

ansible dev <span class="nt">-a</span> <span class="s2">"php --version"</span>
ansible <span class="nb">test</span> <span class="nt">-a</span> <span class="s2">"mariadb --version"</span>
ansible dev <span class="nt">-a</span> <span class="s2">"yum update"</span>
ansible dev <span class="nt">-a</span> <span class="s2">"yum grouplist"</span>  <span class="c"># need remember</span>

Q4: selinux roles

yum search roles
<span class="nb">sudo </span>yum <span class="nb">install </span>rhel-system-roles.noarch <span class="nt">-y</span>  <span class="c"># remember to search role</span>

ansible-galaxy list            <span class="c"># when role = galaxy to list installed roles</span>
<span class="c"># /home/greg/ansible/roles</span>
<span class="c"># /usr/share/ansible/roles</span>
- rhel-system-roles.selinux

<span class="c"># go /usr/share/doc tp find example</span>

<span class="nb">cp</span> /usr/share/doc/rhel-system-roles/selinux/example-selinux-playbook.yml /home/greg/ansible/selinux.yml

vim /home/greg/ansible/selinux.yml

remove and keep:

vars: <span class="c"># keep </span>

tasks: 
    block


<span class="nt">---</span>
- hosts: all
  become: <span class="nb">true
  </span>become_method: <span class="nb">sudo
  </span>become_user: root
  vars:
    <span class="c"># Use "targeted" SELinux policy type</span>
    selinux_policy: targeted
    <span class="c"># Set "enforcing" mode</span>
    selinux_state: enforcing
    <span class="c"># Switch some SELinux booleans</span>
  tasks:
    - name: execute the role and catch errors
      block:
        - name: Include selinux role
          include_role:
            name: rhel-system-roles.selinux
      rescue:
        <span class="c"># Fail if failed for a different reason than selinux_reboot_required.</span>
        - name: handle errors
          fail:
            msg: <span class="s2">"role failed"</span>
          when: not selinux_reboot_required

        - name: restart managed host
          reboot:

        - name: <span class="nb">wait </span><span class="k">for </span>managed host to come back
          wait_for_connection:
            delay: 10
            <span class="nb">timeout</span>: 300

        - name: reapply the role
          include_role:
            name: rhel-system-roles.selinux

ansible-playbook <span class="nt">--syntax-check</span> selinux.yml

USE ansible-playbook
ansible-playbook selinux.yml


Validate:

<span class="c"># getenforce</span>
ansible all <span class="nt">-a</span> <span class="s2">"getenforce"</span>
<span class="c"># /ect/selinux/config, use grep -E `^SELINUX=` </span>
ansible all <span class="nt">-a</span> <span class="s2">"grep -E '^SELINUX=' /etc/selinux/config"</span>


Q5: <span class="nb">install </span>collections

ansible-galaxy collection <span class="nb">install</span> <span class="nt">-r</span> <span class="nt">-p</span>

vim requirements.yml  <span class="c"># need remember !! all as yml</span>

<span class="nt">---</span>
collections:
- name: http://classroom/materials/redhat-insights-1.0.7.tar.gz
- name: http://classroom/materials/community-general-5.5.0.tar.gz
- name: http://classroom/materials/redhat-rhel_system_roles-1.19.3.tar.gz

ansible-galaxy collection <span class="nb">install</span> <span class="nt">-r</span> requirements.yml <span class="nt">-p</span> /home/greg/ansible/mycollection

validation:

ansible-navigator collections
ansible-galaxy collection list

Q6: Galaxy <span class="nb">install </span>roles


ansible-galaxy role <span class="nb">install</span> <span class="nt">--help</span>

vim /home/greg/ansible/roles/requirements.yml

<span class="c"># no roles here !!!</span>
<span class="nt">---</span>
- src: http://classroom/materials/haproxy.tar
  name: balancer
- src: http://classroom/materials/phpinfo.tar
  name: phpinfo

ansible-galaxy role <span class="nb">install</span> <span class="nt">-r</span> /home/greg/ansible/roles/requirements.yml <span class="nt">-p</span> /home/greg/ansible/roles/

validate:
ansible-galaxy list
<span class="c"># /home/greg/ansible/roles</span>
- balancer, <span class="o">(</span>unknown version<span class="o">)</span>
- phpinfo, <span class="o">(</span>unknown version<span class="o">)</span>

ll /home/greg/ansible/roles/
total 4
drwxr-xr-x. 9 greg greg 122 Jul  1 07:35 balancer
drwxr-xr-x. 9 greg greg 118 Jul  1 07:35 phpinfo
<span class="nt">-rw-r--r--</span><span class="nb">.</span> 1 greg greg 129 Jul  1 07:34 requirements.yml

Q7: galaxy init role apache

<span class="c"># initiate apache role, remember the path</span>
ansible-galaxy role init roles/apache

<span class="c"># get fact by setup module, search for "ansible_nodename" and "ansible_default_ipv4"</span>
ansible dev <span class="nt">-m</span> setup <span class="o">&gt;</span> xxx.txt
vim xxx.txt
/nodename
/ansible_default_ipv4

<span class="c"># create file "index.html.j2" under roles/apache/templates/ to define content</span>
<span class="c"># use  to define build in vars for ansible</span>

vim roles/apache/templates/index.html.j2
Welcome to  on 

<span class="c"># check for tree for apache role</span>
tree roles/apache

<span class="c"># add task in /roles/apache/tasks/main.yml</span>
vim /home/greg/ansible/roles/apache/tasks/main.yml

<span class="c"># search for yum module to install httpd and firewalld</span>
<span class="c"># search for systemd module to enable and start httpd and firewalld service</span>
<span class="c"># search for command module, use cmd to pass shell command to add firewall-cmd for http service and reload</span>
<span class="c"># use -template with src and dest to define j2 template</span>
<span class="c"># ansible-navigator collections</span>
<span class="c"># go ansible.posix</span>
<span class="c"># go firewalld  / EXAMPLES  !!! immediate: yes</span>
<span class="nt">---</span>
- name: Install the latest version of Apache
  ansible.builtin.yum:
    name: httpd
    state: latest

- name: Enable and start service httpd
  ansible.builtin.systemd:
    name: httpd
    enabled: <span class="nb">yes
    </span>state: started

- name: Ensure firewalld is installed
  ansible.builtin.yum:
    name: firewalld
    state: present

- name: Ensure firewalld is running and enabled
  ansible.builtin.systemd:
    name: firewalld
    state: started
    enabled: <span class="nb">yes</span>

<span class="c">#- name: enable http on firewalld                         </span>
<span class="c">#  ansible.builtin.command: </span>
<span class="c">#    cmd: firewall-cmd --permanent --add-service=http</span>

<span class="c">#- name: reload firewalld</span>
<span class="c">#  ansible.builtin.command: </span>
<span class="c">#    cmd: firewall-cmd --reload</span>

- name: Start apache
  ansible.posix.firewalld:  <span class="c"># 注意防火墙中Apache服务名不是httpd</span>
    service: http
    permanent: <span class="nb">yes
    </span>state: enabled
    immediate: <span class="nb">yes</span>  <span class="c"># immediate</span>


- template:
    src: index.html.j2
    dest: /var/www/html/index.html

<span class="c"># create a apache.yml to use the role</span>

vim /home/greg/ansible/apache.yml

<span class="nt">---</span>
- name: apache role
  hosts: webservers
  roles:
  - apache

<span class="c"># run apache.yml to apply the role</span>
ansible-navigator run apache.yml <span class="nt">-m</span> stdout

validate 

go browser
http://node3
http://node4


Q8: use role <span class="s2">"phpinfo"</span> and <span class="s2">"balancer"</span> from galaxy

vim /home/greg/ansible/roles.yml

<span class="nt">---</span>
- name: balacer role
  hosts: balancers
  roles:
  - balancer

- name: phpinfo role
  hosts: webservers
  roles:
  - phpinfo

ansible-navigator run roles.yml <span class="nt">-m</span> stdout

validate:

go browser

http://node5
http://node5

http://node3/hello.php
http://node4/hello.php

Q9: Create and use LV

ansible-navigator doc

ansible-navigator doc community.general.system.lvol
ansible-navigator doc community.general.system.filesystem

ansible-doc debug

vim /xxx.txt
/ find lvm
ansible_lvm.vgs.research

/home/greg/ansible/lv.yml

<span class="nt">---</span>
- name: lv
  hosts: all
  tasks:
  - block  <span class="c"># remember</span>
    - name: Create a logical volume of 1500m        
      community.general.lvol:  
        vg: research           
        lv: data               
        size: 1500             
 
    - name: Create a ext4 filesystem
      community.general.filesystem:
        fstype: ext4           
        dev: /dev/research/data

    rescue: <span class="c"># rescue indentation </span>
    - name: Create a logical volume of 800m        
      community.general.lvol:  
        vg: research           
        lv: data               
        size: 800             
 
    - name: Create a ext4 filesystem
      community.general.filesystem:
        fstype: ext4           
        dev: /dev/research/data
    
    - ansible.builtin.debug:
        msg: Could not create logical volume of that size
      when: ansible_lvm.vgs.research is defined   <span class="c"># vim setup for ansible fact </span>

  - ansible.builtin.debug:           <span class="c"># ~~ remember indentation</span>
      msg: Volume group <span class="k">done </span>not exist
    when: ansible_lvm.vgs.research is not defined       

ansible-playbook <span class="nt">--syntax-check</span> lv.yml
ansible-navigator run lv.yml <span class="nt">-m</span> stdout

validate

ansible all <span class="nt">-a</span> <span class="s2">"blkid /dev/research/data"</span>
ansible all <span class="nt">-m</span> shell <span class="nt">-a</span> <span class="s1">'lsblk'</span>


Q10: myhosts j2

vim xxx.txt

<span class="c"># /find bellow keywords for j2 </span>
ipv4
nodename
<span class="nb">hostname</span>


<span class="c"># understand ansible biuldin vars</span>

groups.all
groups.dev
inventory_hostname
hostvars[i]

<span class="c"># j2 for loop</span>


<span class="c"># ansible-doc template</span>

wget http://classroom/materials/hosts.j2

vim /home/greg/ansible/hosts.yml

<span class="nt">---</span>
- name: j2
  hosts: all  <span class="c"># has to go all to get all groups.all hosts</span>
  tasks:
  - name: Template a hostfile
    ansible.builtin.template:template
      src: /home/greg/ansible/hosts.j2
      dest: /etc/myhosts
    when: inventory_hostname <span class="k">in </span>groups.dev <span class="c"># only excute for dev hosts</span>

vim hosts.j2



ansible-navigator run hosts.yml <span class="nt">-m</span> stdout


validate:

ansible dev <span class="nt">-a</span> <span class="s2">"cat /etc/myhosts"</span>

Q11: issue, change file

groups.dev
groups.test
inventory_hostname

ansible-doc copy

vim /home/greg/ansible/issue.yml

<span class="nt">---</span>
- name: issue
  hosts: all
  tasks:
  - name: dev
    ansible.builtin.copy:
      content: <span class="s1">'Development'</span>
      dest: /etc/issue
    when: inventory_hostname <span class="k">in </span>groups.dev

  - name: <span class="nb">test
    </span>ansible.builtin.copy:
      content: <span class="s1">'Test'</span>
      dest: /etc/issue
    when: inventory_hostname <span class="k">in </span>groups.test

  - name: prod
    ansible.builtin.copy:
      content: <span class="s1">'Production'</span>
      dest: /etc/issue
    when: inventory_hostname <span class="k">in </span>groups.prd

ansible-navigator run issue.yml <span class="nt">-m</span> stdout

validate:

ansible all <span class="nt">-a</span> <span class="s2">"cat /etc/issue"</span>

Q12: create WEB content

ansible-doc copy   <span class="o">!!</span>  setype

ansible-doc file
ansible-doc group

ansible dev <span class="nt">-a</span> <span class="s2">"ls -Z /var/www/html"</span>

vim /home/greg/ansible/webcontent.yml
<span class="nt">---</span>
- name: create web
  hosts: dev
  roles:
  - apache
  tasks:
  - name: Ensure group <span class="s2">"webdev"</span> exists
    ansible.builtin.group:
      name: webdev
      state: present

  - name: create <span class="nb">dir
    </span>ansible.builtin.file:
      path: /webdev
      state: directory
      mode: u+rwx,g+rws,o+rx
      group: webdev

  - name: <span class="nb">link
    </span>ansible.builtin.file:
      src: /webdev   <span class="c"># remember order for syc and dest</span>
      dest: /var/www/html/webdev
      state: <span class="nb">link</span>

  - name: copy content
    ansible.builtin.copy:
      content: <span class="s1">'Development'</span>
      dest: /webdev/index.html
      setype: httpd_sys_content_t   <span class="c"># man semanage fcontext for httpd_sys_content_t</span>

ansible dev <span class="nt">-a</span> <span class="s2">"ls -Z /var/www/html"</span>

validate :

http://node1/devweb


Q13: hardware report

<span class="c"># get empty report, understand keywords</span>
wget http://materials/hwreport.empty
vim hwreport.empty


vim xxx.txt
<span class="c"># /find vars in setup</span>
ansible_memtotal_mb
ansible_bios_version
vda
ansible_devices.vda.size

<span class="c"># user get_url and lininfile module</span>
ansible-doc get_url

ansible-doc lineinfile


vim /home/greg/ansible/hwreport.yml
<span class="nt">---</span>
- name: hardware report
  hosts: all
  tasks:
  - name: Copy file 
    ansible.builtin.get_url:
      url: http://classroom/materials/hwreport.empty
      dest: /root/hwreport.txt

  - name: <span class="nb">hostname
    </span>ansible.builtin.lineinfile:
      path: /root/hwreport.txt
      regexp: <span class="s1">'^HOST='</span>
      line: <span class="s2">"HOST="</span>
  - name: memory
    ansible.builtin.lineinfile:
      path: /root/hwreport.txt
      regexp: <span class="s1">'^MEMORY='</span>
      line: <span class="s2">"MEMORY="</span>
  - name: bios
    ansible.builtin.lineinfile:
      path: /root/hwreport.txt
      regexp: <span class="s1">'^BIOS='</span>
      line: <span class="s2">"BIOS="</span>
  - name: vda
    ansible.builtin.lineinfile:
      path: /root/hwreport.txt
      regexp: <span class="s1">'^DISK_SIZE_VDA='</span>
      line: <span class="s2">"DISK_SIZE_VDA="</span>
  - name: <span class="nb">hostname
    </span>ansible.builtin.lineinfile:
      path: /root/hwreport.txt
      regexp: <span class="s1">'^DISK_SIZE_VDB='</span>
      line: <span class="s2">"DISK_SIZE_VDB="</span> <span class="c"># remember # () need remember</span>

ansible-playbook <span class="nt">--syntax-check</span> hwreport.yml
ansible-navigator run <span class="nt">-m</span> stdout hwreport.yml

validate 
ansible all <span class="nt">-a</span> <span class="s2">"cat /root/hwreport.txt"</span>


Q14: vault

ansible-vault <span class="nt">--help</span>

ansible-vault create /home/greg/ansible/locker.yml 
password

<span class="nb">echo </span>whenyouwishuponastar <span class="o">&gt;</span> /home/greg/ansible/secret.txt

validate:

<span class="nb">cat</span> /home/greg/ansible/locker.yml
ansible-vault view /home/greg/ansible/locker.yml
password




Q15: user

<span class="c"># understand user list</span>
wget  http://classroom/materials/user_list.yml
<span class="nb">cat </span>user_list.yml 

<span class="c"># understand user and group module</span>
ansible-doc user
ansible-doc group

<span class="c"># define vars_files in playbook</span>
vars_files
/home/greg/ansible/user_list.yml
/home/greg/ansible/locker.yml

<span class="c"># set passwd file in ansible.cfg, # search for vault then add bellow</span>
vim ansible.cfg1
vim ansible.cfg

vault_password_file <span class="o">=</span> /home/greg/ansible/secret.txt

<span class="c"># understand passwd hash</span>
passwd hash512
| password_hash<span class="o">(</span><span class="s1">'sha512'</span><span class="o">)</span> 


vim /home/greg/ansible/users.yml

<span class="nt">---</span>
- name: u1
  hosts: dev, <span class="nb">test
  </span>vars_files:
  - /home/greg/ansible/user_list.yml
  - /home/greg/ansible/locker.yml
  tasks:
  - name: group1
    ansible.builtin.group:
      name: devops
      state: present
  - name: u1
    ansible.builtin.user:
      name: <span class="s2">""</span>
      password_expire_max: <span class="s2">""</span>  
      uid: <span class="s2">""</span>
      group: devops
      password: <span class="s2">""</span>  <span class="c"># remember </span>
    loop: <span class="s2">""</span>
    when: item.job <span class="o">==</span> <span class="s2">"developer"</span> 

- name: u2
  hosts: prod
  vars_files:
  - /home/greg/ansible/user_list.yml
  - /home/greg/ansible/locker.yml
  tasks:
  - name: group2
    ansible.builtin.group:
      name: opsmgr
      state: present
  - name: Set u2
    ansible.builtin.user:
      name: <span class="s2">""</span>
      password_expire_max: <span class="s2">""</span>
      <span class="nb">groups</span>: opsmgr
      password: <span class="s2">""</span>
      uid: <span class="s2">""</span>
    loop: <span class="s2">""</span>
    when: item.job <span class="o">==</span> <span class="s2">"manager"</span>


validate 

ansible all <span class="nt">-a</span> <span class="s2">"id bob"</span>
ansible all <span class="nt">-a</span> <span class="s2">"id sally"</span>

ssh bob@node1 Imadev
ssh sally@node3 Imamgr

Q16: vault rekey

wget http://classroom/materials/salaries.yml

ansible-vault rekey salaries.yml
old password
new password

vaildate:

<span class="nb">cat </span>salaries.yml 

ansible-vault view salaries.yml 
Vault password: 

Q17: cron

ansible-doc cron


vim /home/greg/ansible/cron.yml

<span class="nt">---</span>
- name: cron
  hosts: <span class="nb">test
  </span>tasks:
  - name: cron job
    ansible.builtin.cron:
      name: <span class="s2">"cron job1"</span>
      minute: <span class="s2">"*/2"</span>   <span class="c"># remember "" to inlude </span>
      job: <span class="s1">'logger "EX200 in progress"'</span> <span class="c"># remember '""'</span>
      user: natasha

ansible-playbook <span class="nt">--syntax-check</span> cron.yml
ansible-navigator run <span class="nt">-m</span> stdout cron.yml

validate:

ansible <span class="nb">test</span> <span class="nt">-a</span> <span class="s2">"crontab -l -u natasha"</span></code></pre></figure>

  </div><a class="u-url" href="/jekyll/cat2/2024/07/03/redhat-cert.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Zack&#39;s Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Zack&#39;s Blog</li><li><a class="u-email" href="mailto:zhbsoftboy1@gmail.com">zhbsoftboy1@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ZackZhouHB"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ZackZhouHB</span></a></li><li><a href="https://www.twitter.com/ZackZ"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">ZackZ</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>## AWS   ## Jenkins  ## Microservices ## Automation ## K8S   ## CICD     ## Gitops </p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
